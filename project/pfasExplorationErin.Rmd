---
title: "PFAS Data Exploration"
author: "Erin Franke"
date: "2023-03-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries and data

```{r}
library(tidyverse)
library(skimr)
library(readxl)
library(sf)
library(USAboundaries)
```

```{r, message=FALSE, warning=FALSE}
# data provided my MPCA
pfas <- read_xlsx("../data/Twin Cities PFAS Data Ticket WO00000021224685.xlsx", sheet=2)

counties <- us_counties(resolution = "high", states = c("Minnesota", "Wisconsin")) %>%
  st_transform(crs = 6783)
rivers <- read_sf('../data/shp_water_lakes_rivers') %>%
  st_transform(crs = 6783)
```

## General data information

General statistics from the data

```{r}
skim(pfas)
```

Top 7 types of PFAS with percent detection and total number of samples.

```{r}
pfas %>%
  count(CHEMICAL_NAME, DETECT_FLAG) %>%
  pivot_wider(names_from = DETECT_FLAG, values_from = n) %>%
  mutate(percent_detect = Y/(Y+N), total = N+Y) %>%
  arrange(desc(percent_detect)) %>%
  filter(total > 5000) %>%
  mutate(commonName = c("PFBA", "PFOA", "PFPeA", "PFHxA", "PFOS", "PFHxS", "PFBS"))
```

Filter for only these types of PFAS

```{r}
pfas7 <- pfas %>%
  filter(CHEMICAL_NAME %in% c("Perfluorobutanoic acid", "Perfluorooctanoic acid", "Perfluoropentanoic acid", "Perfluorohexanoic acid", "Perfluorooctane sulfonate", "Perfluorohexane sulfonate", "Perfluorobutane sulfonate")) %>%
  mutate(commonName = case_when(CHEMICAL_NAME == "Perfluorobutanoic acid" ~ "PFBA", 
                                CHEMICAL_NAME == "Perfluorooctanoic acid" ~ "PFOA", 
                                CHEMICAL_NAME == "Perfluoropentanoic acid" ~ "PFPeA",
                                CHEMICAL_NAME == "Perfluorohexanoic acid" ~ "PFHxA", 
                                CHEMICAL_NAME == "Perfluorooctane sulfonate" ~ "PFOS", 
                                CHEMICAL_NAME == "Perfluorohexane sulfonate" ~ "PFHxS", 
                                CHEMICAL_NAME == "Perfluorobutane sulfonate" ~ "PFBS")) %>%
  mutate(LOC_TYPE_2 = case_when(LOC_TYPE_2 == "Well-DOmestic" ~ "Well-Domestic", 
                                TRUE ~ LOC_TYPE_2))
```

What types of locations are we interested in? 

- "Well-Domestic", "Well-Monitoring", and "River/Stream" with "River/Stream Peren".

```{r}
pfas7 %>%
  count(LOC_TYPE_2) %>%
  arrange(desc(n)) %>%
  head(10)
```

# Understanding contamination based on sample type (well, stream, etc)

This map of PFAS samples and whether or not there was detection. This includes all sample locations. 

```{r}
pfas7_sf <- st_as_sf(pfas7 %>%
                       filter(!is.na(LATITUDE), LATITUDE <45.5, LATITUDE >44.4), coords = c("LONGITUDE", "LATITUDE"), crs = 6783)

counties_cropped <- st_crop(counties, st_bbox(pfas7_sf))
pfas7 %>%
  ggplot()+
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data = pfas7_sf, size= 1, aes(color = DETECT_FLAG))+
  theme(axis.line = element_blank(),
        axis.text = element_blank(), 
        axis.ticks = element_blank())+
  labs(title = "PFAS samples in the greater Twin Cities", color = "Detection?")
```

## Rivers and Streams

Detection in rivers and streams

```{r}
sf_use_s2(FALSE)

river_stream <- pfas7 %>% 
  filter(LOC_TYPE_2 %in% c("River/Stream", "River/Stream Peren"), 
         !is.na(LATITUDE), !is.na(LONGITUDE), 
         LATITUDE > 44.671, LONGITUDE > -93.2, LONGITUDE < -92.6) 
river_stream <- st_as_sf(river_stream, coords = c("LONGITUDE", "LATITUDE"), crs = 6783)

counties_cropped <- st_crop(counties, xmin = -93.2, xmax = -92.6, ymin = 44.6, ymax = 45.02)
rivers_cropped <- st_crop(rivers, st_bbox(river_stream))

ggplot()+
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data= rivers_cropped, fill = "blue", color = "blue")+
  geom_sf(data = river_stream, size= 1, aes(color = DETECT_FLAG))
```

Zoom in on part of river and plot what type of PFAS is being sampled for

```{r}
river_stream <- pfas7 %>% 
  filter(LOC_TYPE_2 %in% c("River/Stream", "River/Stream Peren"), 
         !is.na(LATITUDE), !is.na(LONGITUDE), 
         LATITUDE > 44.65, LATITUDE <44.85, LONGITUDE > -93, LONGITUDE < -92.8, DETECT_FLAG == "Y") 
river_stream <- st_as_sf(river_stream, coords = c("LONGITUDE", "LATITUDE"), crs = 6783)

counties_cropped <- st_crop(counties, st_bbox(river_stream))
rivers_cropped <- st_crop(rivers, st_bbox(river_stream))

ggplot()+
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data= rivers_cropped, fill = "blue", color = "blue")+
  geom_sf(data = river_stream, size= 0.9, aes(color = commonName), alpha = 0.5)

river_stream %>%
  filter(DETECT_FLAG == "Y") %>%
  count(commonName)
```


## Wells 

Filter for PFAS samples in Domestic and Monitoring wells. PFAS in well has largely been detected in southern Washington county, though there are spots over neighboring counties where it has also been detected. 	PFBA has the most detection with over 9,000. 

```{r}
well <- pfas7 %>% 
  filter(LOC_TYPE_2 %in% c("Well-Domestic", "Well-Monitoring"), 
         !is.na(LATITUDE), !is.na(LONGITUDE), 
         LATITUDE <46, LATITUDE >44, LONGITUDE > -94.5, LONGITUDE < -92.2) 
well <- st_as_sf(well, coords = c("LONGITUDE", "LATITUDE"), crs = 6783)

counties_cropped <- st_crop(counties, st_bbox(pfas7_sf))

ggplot()+
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data = well, size= 1, aes(color = DETECT_FLAG))+
  theme(axis.line = element_blank(),
        axis.text = element_blank(), 
        axis.ticks = element_blank())+
  labs("PFAS in wells in the greater Twin Cities", color = "Detection")
  

well %>%
  filter(DETECT_FLAG == "Y") %>%
  count(commonName)
```

## Superfund sites in Washington County

```{r}
threeM <- read_csv("../data/superfund_site_data/3m_chemolite.csv") %>%
  mutate(site = "3M Chemolite")
oakdale <- read_csv("../data/superfund_site_data/oakdale.csv") %>%
  mutate(site = "3M Oakland")
ashland <- read_csv("../data/superfund_site_data/ashland.csv") %>%
  mutate(site = "Ashland Oil - Park Penta")
bayport <- read_csv("../data/superfund_site_data/bayport.csv") %>%
  mutate(site = "Baytown Township")
lakeland <- read_csv("../data/superfund_site_data/lakeland.csv") %>%
  mutate(site = "Lakeland")

superfund_washington <- bind_rows(threeM, oakdale, ashland, bayport, lakeland) %>%
  filter(!is.na(LATITUDE), LATITUDE > 40, LONGITUDE > -93, LONGITUDE < -91) %>%
  filter(ANALYTE_NAME %in% c("Perfluorohexanoic acid (PFHxA)", "Perfluorohexanesulfonate (PFHxS)", "Perfluorooctanesulfonate (PFOS)", "Perfluorooctanoic acid (PFOA)", "Perfluoropentanoic acid (PFPeA)", "Perfluorobutanesulfonate (PFBS)", "Perfluorobutanoic acid (PFBA)")) %>%
  mutate(commonName = case_when(ANALYTE_NAME == "Perfluorobutanoic acid (PFBA)" ~ "PFBA", 
                                ANALYTE_NAME == "Perfluorooctanoic acid (PFOA)" ~ "PFOA", 
                                ANALYTE_NAME == "Perfluoropentanoic acid (PFPeA)" ~ "PFPeA",
                                ANALYTE_NAME == "Perfluorohexanoic acid (PFHxA)" ~ "PFHxA", 
                                ANALYTE_NAME == "Perfluorooctanesulfonate (PFOS)" ~ "PFOS", 
                                ANALYTE_NAME == "Perfluorohexanesulfonate (PFHxS)" ~ "PFHxS", 
                                ANALYTE_NAME == "Perfluorobutanesulfonate (PFBS)" ~ "PFBS"), 
         RESULT_NUMERIC = case_when(RESULT_UNIT == "ng/L" ~ RESULT_NUMERIC/ 1000, 
                                    TRUE ~ RESULT_NUMERIC))
  

counties_cropped <- st_crop(counties, xmin = -93.2, xmax=-92.7, ymin = 44.7, ymax=45.35)

ggplot()+
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data = superfund_washington, size= 0.9, aes(color = site), alpha = 0.5)+
  labs(title = "Fun map!", subtitle = "Washington County")
```

```{r}
ggplot() +
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data = (superfund_washington %>% filter(commonName == "PFOA") %>% mutate(over_limit = RESULT_NUMERIC > 0.035, over_limit = case_when(is.na(over_limit) ~ FALSE, TRUE ~ over_limit))), size= 0.9, aes(color = over_limit), alpha = 0.5)

ggplot() +
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data = (superfund_washington %>% filter(commonName == "PFBA") %>% mutate(over_limit = RESULT_NUMERIC > 7, over_limit = case_when(is.na(over_limit) ~ FALSE, TRUE ~ over_limit))), size= 0.9, aes(color = over_limit), alpha = 0.5)

ggplot() +
  geom_sf(data = counties_cropped, color = "navajowhite", fill = "ivory", size = 0.5)+
  geom_sf(data = (superfund_washington %>% filter(commonName == "PFPeA", RESULT_NUMERIC >0)), size= 0.9, aes(color = RESULT_NUMERIC), alpha = 0.5)+
  scale_color_gradient(low = "pink", high = "darkred")
```


