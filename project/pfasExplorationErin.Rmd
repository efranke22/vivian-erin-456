---
title: "PFAS Data Exploration"
author: "Erin Franke"
date: "2023-03-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(skimr)
library(readxl)
library(sf)
library(USAboundaries)
```

```{r, message=FALSE, warning=FALSE}
pfas <- read_xlsx("../data/Twin Cities PFAS Data Ticket WO00000021224685.xlsx", sheet=2)
```

```{r}
skim(pfas)
pfas %>%
  count(CHEMICAL_NAME, DETECT_FLAG) %>%
  pivot_wider(names_from = DETECT_FLAG, values_from = n) %>%
  mutate(percent_detect = Y/(Y+N), total = N+Y) %>%
  arrange(desc(percent_detect)) %>%
  filter(total > 5000) %>%
  mutate(commonName = c("PFBA", "PFOA", "PFPeA", "PFHxA", "PFOS", "PFHxS", "PFBS"))
```

```{r}
pfas %>%
  filter(CHEMICAL_NAME == "Perfluorooctanoic acid") %>%
  count(LOC_TYPE_2) %>%
  arrange(desc(n))

pfas %>%
  filter(CHEMICAL_NAME == "Perfluorooctanoic acid") %>%
  group_by(LOC_TYPE_2) %>%
  mutate(count = n()) %>%
  filter(count > 900) %>%
  count(DETECT_FLAG)

pfas %>%
  filter(CHEMICAL_NAME == "Perfluorooctanoic acid", LOC_TYPE_2 == "Well-Domestic") %>%
  filter(!is.na(LONGITUDE), !is.na(LATITUDE)) %>%
  st_as_sf(coords = c("LONGITUDE", "LATITUDE"), crs ="WGS 84") %>%
  ggplot()+
  geom_sf()
```

